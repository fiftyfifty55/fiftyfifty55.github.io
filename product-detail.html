<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å•†å“è©³æƒ…</title>
  <style>
    :root{
      --bg: #f6f1ee;
      --panel: #efe4e0;
      --ink: #151515;
      --muted: #6e6e6e;
      --line: rgba(0,0,0,.12);
      --chip: #e6d7d1;
      --btn: #d7bfb7;
      --btnText: #1a1a1a;
      --star: #f3c44b;
    }
    *{ box-sizing: border-box; }
    body{
      margin:0;
      font-family: system-ui,"Noto Sans TC";
      background: var(--bg);
      color: var(--ink);
    }
    .wrap{ max-width:1080px; margin:0 auto; padding:28px 18px 60px; }

    .top{ display:grid; grid-template-columns: 1.05fr 1fr; gap:40px; align-items:start; }

    /* gallery */
    .gallery{ position: relative; }
    .imgBox{
      width:100%; aspect-ratio:1/1;
      background: var(--panel);
      border-radius:10px;
      display:flex; align-items:center; justify-content:center;
      font-weight:700; letter-spacing:2px; color:rgba(0,0,0,.35);
    }
    .dots{ display:flex; gap:10px; justify-content:center; padding:14px 0 0; }
    .dot{
      width:8px; height:8px; border-radius:50%; background: rgba(0,0,0,.18); cursor:pointer;
    }
    .dot.active{ background: rgba(0,0,0,.55); }

    /* info */
    .info h1{ margin:0; font-size:36px; font-weight:900; letter-spacing:1px; }
    .price{ margin-top:6px; font-size:28px; font-weight:800; }

    .meta{
      margin-top:10px;
      display:flex; align-items:center; gap:12px;
      color: var(--muted); font-size:13px; flex-wrap:wrap;
    }
    .rating{ display:flex; align-items:center; gap:6px; }
    .stars{ display:inline-flex; gap:2px; transform: translateY(1px); }
    .star{ width:16px; height:16px; display:inline-block; fill:currentColor; color:var(--star); }
    .meta .divider{ width:1px; height:14px; background: var(--line); }

    .rule{ margin:16px 0; height:1px; background:var(--line); }

    /* tabs + options */
    .specHead{ display:flex; align-items:center; gap:10px; margin-top:10px; }
    .specHead .label{ font-size:14px; font-weight:800; }
    .tabs{ display:flex; gap:8px; }
    .tab{
      border:1px solid var(--line); background:transparent;
      padding:6px 10px; border-radius:999px; font-size:12px; cursor:pointer; color:#333;
    }
    .tab.active{ background:var(--chip); border-color:transparent; font-weight:700; }

    .options{ margin-top:12px; min-height:58px; position:relative; }
    .optRow{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .sizeBtn{
      width:34px; height:34px; border-radius:50%; border:1px solid rgba(0,0,0,.25);
      background:transparent; cursor:pointer; font-weight:700;
    }
    .sizeBtn.active{
      background:#fff; border-color:rgba(0,0,0,.55); box-shadow:0 1px 0 rgba(0,0,0,.05);
    }
    .colorDot{
      width:28px; height:28px; border-radius:50%; border:1px solid rgba(0,0,0,.12);
      cursor:pointer; position:relative;
    }
    .colorDot.active{
      outline:2px solid rgba(0,0,0,.55); outline-offset:2px;
    }

    .bubbleRight{
      margin-top:8px; display:inline-block;
      background:#cdb4aa; padding:8px 10px; border-radius:6px; font-size:12px;
      position:relative; color:#1a1a1a;
    }
    .bubbleRight::after{
      content:""; position:absolute; left:14px; top:-8px;
      border-width:8px; border-style:solid;
      border-color: transparent transparent #cdb4aa transparent;
    }

    /* CTA row */
    .ctaRow{ margin-top:16px; display:flex; gap:10px; align-items:center; }
    .addBtn{
      flex:1; height:38px; border:none; border-radius:6px;
      background:var(--btn); color:var(--btnText); font-weight:800; cursor:pointer;
    }
    .pawBtn{
      width:38px; height:38px; border:none; border-radius:6px;
      background:var(--btn); cursor:pointer; font-size:18px;
      display:flex; align-items:center; justify-content:center;
    }

    /* sections below */
    .section{ margin-top:28px; }
    .section h2{ margin:0 0 10px; font-size:14px; letter-spacing:1px; font-weight:900; }
    .block{
      background:var(--panel); border-radius:10px; padding:26px;
      min-height:120px; display:flex; align-items:center; justify-content:center;
      color:rgba(0,0,0,.55); text-align:center; line-height:1.6;
    }

    /* reviews */
    .reviewHead{ display:flex; align-items:center; gap:10px; margin-bottom:10px; }
    .reviewScore{ display:flex; align-items:center; gap:8px; color:var(--muted); font-size:12px; }
    .reviewCards{ display:grid; gap:12px; }
    .reviewCard{ background:rgba(0,0,0,.06); border-radius:999px; height:52px; }

    /* also bought */
    .alsoTitle{ margin-top:36px; display:flex; align-items:center; gap:14px; justify-content:center; color:#111; font-weight:900; letter-spacing:2px; }
    .line{ flex:1; height:2px; background:rgba(0,0,0,.35); max-width:220px; }
    .cards{ margin-top:18px; display:grid; grid-template-columns: repeat(4,1fr); gap:16px; }
    .card{ background:var(--panel); border-radius:12px; aspect-ratio:4/5;
           display:flex; align-items:center; justify-content:center; color:rgba(0,0,0,.55); font-weight:700; }

    footer{ margin-top:26px; background:#d8c0b7; height:56px; display:flex; align-items:center; justify-content:center; color:rgba(0,0,0,.65); letter-spacing:1px; }

    @media (max-width:860px){
      .top{ grid-template-columns: 1fr; }
      .cards{ grid-template-columns: repeat(2,1fr); }
    }
  </style>
</head>
<body onload="renderComments()">
  <div class="wrap">
    <section class="top">

      <!-- left: gallery -->
      <div class="gallery">
        <div class="imgBox" id="mainImage">å•†å“ç…§ç‰‡</div>
        <div class="dots" id="dotsArea"></div>
      </div>

      <!-- right: info -->
      <div class="info">
        <h1 id="prodName">å•†å“å</h1>
        <div class="price" id="prodPrice">$XXX</div>

        <div class="meta" id="metaArea">
          <!-- æœƒç”± JS å¡å…¥ å·²è³¼è²· & æ˜Ÿç­‰ & è©•è«–æ•¸ -->
        </div>

        <div class="rule"></div>

        <div class="specHead">
          <div class="label" id="specLabel">è¦æ ¼</div>
          <div class="tabs" id="tabsArea"></div>
        </div>

        <div class="options" id="optionsArea">
          <!-- ç”± JS ä¾ variantType ç”Ÿæˆå°ºå¯¸æˆ–é¡è‰² -->
        </div>

        <div class="ctaRow">
          <button class="addBtn" id="addToCartBtn">åŠ å…¥è³¼ç‰©è»Š</button>
          <button class="pawBtn" id="pawBtn" aria-label="æ”¶è—æˆ–åŠ å…¥æœ€æ„›">ğŸ¾</button>
        </div>
      </div>
    </section>

    <!-- ä¸‹æ–¹å€å¡Š -->
    <section class="section">
      <h2>å•†å“ä»‹ç´¹</h2>
      <div class="block" id="descBlock">æ–‡å­—ä»‹ç´¹ï¼ˆç¤ºæ„ï¼‰</div>
    </section>

    <section class="section">
      <h2>è©³ç´°è¦æ ¼</h2>
      <div class="block" id="specBlock">å°ºå¯¸&æè³ªèªªæ˜</div>
    </section>

    <section class="section">
      <h2>ç©æ³•/ç”¨æ³•</h2>
      <div class="block" id="howBlock">åœ–æˆ–æ–‡å­—èªªæ˜</div>
    </section>

    <section class="section" id="reviewSection">
      <div class="reviewHead">
        <h2 style="margin:0;">è©•è«–</h2>
        <div class="reviewScore" id="reviewScoreArea">
          <!-- ç”± JS å¡æ˜Ÿç­‰èˆ‡å¹³å‡åˆ† -->
        </div>
      </div>
      <div class="reviewCards" id="reviewCardsArea">
        <!-- å¯æ”¾çœŸå¯¦è©•è«–ï¼›æš«ç”¨ç¤ºæ„ -->
      </div>
    </section>

    <div class="alsoTitle">
      <div class="line"></div>
      <div>å…¶ä»–äººä¹Ÿè²·äº†</div>
      <div class="line"></div>
    </div>

    <section class="cards" id="alsoArea">
      <div class="card">å•†å“</div>
      <div class="card">å•†å“</div>
      <div class="card">å•†å“</div>
      <div class="card">å•†å“</div>
    </section>

    <footer>footer</footer>
  </div>

  <script src="./products-data.js"></script>
  <script src="details1/detailjs.js></script>
  <script>
    // å– URL åƒæ•¸ ?id=...
    const params = new URLSearchParams(location.search);
    const id = params.get("id"); // MDN: URLSearchParams æ–¹ä¾¿æ“ä½œ query string :contentReference[oaicite:0]{index=0}
    const product = PRODUCTS.find(p => p.id === id);

    if(!product){
      // æ‰¾ä¸åˆ°å•†å“ï¼šå¯å°å›å•†å“é æˆ–é¡¯ç¤ºéŒ¯èª¤
      alert("æ‰¾ä¸åˆ°æ­¤å•†å“");
      location.href = "products.html";
    } else {
      // 1) å¡å•†å“åŸºæœ¬è³‡è¨Š
      document.getElementById("prodName").textContent = product.name;
      document.getElementById("prodPrice").textContent = "$" + product.price;

      // metaï¼šå·²è³¼è²·ã€æ˜Ÿç­‰ã€è©•è«–æ•¸
      const metaArea = document.getElementById("metaArea");
      metaArea.innerHTML = `
        <span>${product.boughtCount} äººå·²è³¼è²·æ­¤ç”¢å“</span>
        <span class="divider"></span>
        <span class="rating">
          <span class="stars" aria-label="æ˜Ÿç­‰">${generateStarsHTML(product.rating)}</span>
          <span>ï¼ˆ${product.reviewCount}ï¼‰</span>
        </span>
      `;

      // description sections
      document.getElementById("descBlock").textContent = product.description || "æš«ç„¡ä»‹ç´¹";
      document.getElementById("specBlock").textContent = product.specs || "æš«ç„¡è¦æ ¼";
      document.getElementById("howBlock").textContent = product.howToUse || "æš«ç„¡èªªæ˜";

      // 2) gallery dots + main image
      const imgBox = document.getElementById("mainImage");
      const dotsArea = document.getElementById("dotsArea");

      // åˆå§‹é¡¯ç¤ºç¬¬ä¸€å¼µ
      let currentIndex = 0;
      function showImage(idx){
        const imgName = product.images[idx];
        // ç›®å‰å…ˆç¤ºæ„æ–‡å­—ï¼Œä¹‹å¾Œå¯æ› <img src="">
        imgBox.textContent = imgName ?? "å•†å“ç…§ç‰‡";
        // æ›´æ–° dot active
        dotsArea.querySelectorAll(".dot").forEach((d,i) => {
          d.classList.toggle("active", i === idx);
        });
      }

      // ç”¢ç”Ÿé»é»
      dotsArea.innerHTML = "";
      product.images.forEach((img, i) => {
        const d = document.createElement("div");
        d.className = "dot" + (i===0?" active":"");
        d.dataset.idx = i;
        d.addEventListener("click", () => {
          currentIndex = i;
          showImage(i);
        });
        dotsArea.appendChild(d);
      });
      showImage(0);

      // 3) variantType æ±ºå®šé¡¯ç¤ºå°ºå¯¸æˆ–é¡è‰²
      const tabsArea = document.getElementById("tabsArea");
      const optionsArea = document.getElementById("optionsArea");
      const specLabel = document.getElementById("specLabel");

      function clearChildren(ele){
        while(ele.firstChild) ele.removeChild(ele.firstChild);
      }

      if(product.variantType === "size"){
        specLabel.textContent = "å°ºå¯¸";
        // åªæœ‰å°ºå¯¸ä¸€å€‹ tab
        tabsArea.innerHTML = `<button class="tab active" data-tab="size">å°ºå¯¸</button>`;

        // options: å°ºå¯¸æŒ‰éˆ•
        const row = document.createElement("div");
        row.className = "optRow";
        product.sizes.forEach((sz, idx) => {
          const btn = document.createElement("button");
          btn.className = "sizeBtn" + (idx===0?" active":"");
          btn.textContent = sz;
          btn.dataset.size = sz;
          btn.addEventListener("click", () => {
            // å–æ¶ˆå…¶ä»– active
            row.querySelectorAll(".sizeBtn").forEach(x=>x.classList.remove("active"));
            btn.classList.add("active");
          });
          row.appendChild(btn);
        });
        // å¯åŠ æç¤ºæ³¡æ³¡
        const bubble = document.createElement("span");
        bubble.className = "bubbleRight";
        bubble.textContent = "é»é¸å°ºå¯¸ä¸Šæ–¹å¯çœ‹åˆ°è©³ç´°å…§å®¹åŠæ•¸é‡";
        row.appendChild(bubble);

        clearChildren(optionsArea);
        optionsArea.appendChild(row);
      }
      else if(product.variantType === "color"){
        specLabel.textContent = "é¡è‰²";
        tabsArea.innerHTML = `<button class="tab active" data-tab="color">é¡è‰²</button>`;

        const row = document.createElement("div");
        row.className = "optRow";
        product.colors.forEach((c, idx) => {
          const dot = document.createElement("div");
          dot.className = "colorDot" + (idx===0?" active":"");
          dot.style.background = c.hex;
          dot.title = c.label;
          dot.dataset.color = c.code;
          dot.addEventListener("click", () => {
            row.querySelectorAll(".colorDot").forEach(x=>x.classList.remove("active"));
            dot.classList.add("active");
          });
          row.appendChild(dot);
        });
        const bubble = document.createElement("span");
        bubble.className = "bubbleRight";
        bubble.textContent = "é»é¸é¡è‰²ä¸Šæ–¹å¯çœ‹åˆ°è©³ç´°å…§å®¹åŠæ•¸é‡";
        row.appendChild(bubble);

        clearChildren(optionsArea);
        optionsArea.appendChild(row);
      }
      else {
        // å…¶ä»– variantType: å…ˆä¸é¡¯ç¤º
        tabsArea.innerHTML = "";
        optionsArea.innerHTML = "";
      }

      // 4) CTA æŒ‰éˆ•
      document.getElementById("addToCartBtn").addEventListener("click", () => {
        let chosen = "";
        if(product.variantType === "size"){
          const sz = optionsArea.querySelector(".sizeBtn.active")?.dataset.size;
          chosen = "å°ºå¯¸ï¼š" + (sz || "æœªé¸");
        } else if(product.variantType === "color"){
          const cl = optionsArea.querySelector(".colorDot.active")?.dataset.color;
          chosen = "é¡è‰²ï¼š" + (cl || "æœªé¸");
        }
        alert("å·²åŠ å…¥è³¼ç‰©è»Šï¼\n" + chosen);
      });
      document.getElementById("pawBtn").addEventListener("click", () => {
        alert("å·²åŠ å…¥æœ€æ„›ï¼ˆç¤ºæ„ï¼‰ğŸ¾");
      });

      // 5) reviews å’Œ also-bought æš«ç”¨ç¤ºæ„ï¼Œå¯å†ä¾è³‡æ–™è£œä¸Š
      // é¡¯ç¤ºå¹³å‡æ˜Ÿç­‰åœ¨ reviewScoreArea
      const reviewScoreArea = document.getElementById("reviewScoreArea");
      reviewScoreArea.innerHTML = `
        ${generateStarsHTML(product.rating)}
        <span>${product.rating.toFixed(1)}</span>
      `;
      // reviewCards å¯æ’å…¥çœŸå¯¦å¡ç‰‡ï¼Œæš«ç•™ç¤ºæ„
    }

    // helper: ç”Ÿæˆæ˜Ÿç­‰ HTMLï¼ˆæ•´æ•¸ 0â€“5ï¼‰
    function generateStarsHTML(rating){
      const full = Math.round(rating); // ç°¡å–®å–æ•´
      let html = "";
      for(let i=0;i<5;i++){
        if(i < full){
          html += `<span class="star" aria-hidden="true">
                    <svg viewBox="0 0 24 24">
                      <path d="M12 17.27 18.18 21 16.54 13.97 22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                    </svg>
                  </span>`;
        } else {
          html += `<span class="star" aria-hidden="true" style="color:rgba(0,0,0,.12);">
                    <svg viewBox="0 0 24 24">
                      <path d="M12 17.27 18.18 21 16.54 13.97 22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                    </svg>
                  </span>`;
        }
      }
      return html;
    }
  </script>
</body>
</html>

