<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å•†å“è©³æƒ… - Meow5</title>

  <style>
    :root{
      --bg:#f6f1ee;
      --panel:#efe4e0;
      --ink:#151515;
      --muted:#6e6e6e;
      --line:rgba(0,0,0,.12);
      --chip:#e6d7d1;
      --btn:#d7bfb7;
      --btnText:#1a1a1a;
      --star:#f3c44b;
      --accent:#b0714d;
      --card:#ffffff;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui,"Noto Sans TC";
      background:var(--bg);
      color:var(--ink);
    }
    .wrap{ max-width:1080px; margin:0 auto; padding:28px 18px 60px; }

    .top{ display:grid; grid-template-columns: 1.05fr 1fr; gap:40px; align-items:start; }

    /* gallery */
    .gallery{ position:relative; }
    .imgBox{
      width:100%;
      aspect-ratio:1/1;
      background:var(--panel);
      border-radius:12px;
      overflow:hidden;
      border:1px solid rgba(0,0,0,.06);
    }
    .imgBox img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .dots{ display:flex; gap:10px; justify-content:center; padding:14px 0 0; }
    .dot{ width:8px; height:8px; border-radius:50%; background:rgba(0,0,0,.18); cursor:pointer; }
    .dot.active{ background:rgba(0,0,0,.55); }

    /* info */
    .info h1{ margin:0; font-size:36px; font-weight:900; letter-spacing:1px; }
    .price{ margin-top:6px; font-size:28px; font-weight:900; color:var(--accent); }

    .meta{
      margin-top:10px;
      display:flex;
      align-items:center;
      gap:12px;
      color:var(--muted);
      font-size:13px;
      flex-wrap:wrap;
    }
    .rating{ display:flex; align-items:center; gap:6px; }
    .stars{ display:inline-flex; gap:2px; transform:translateY(1px); }
    .star{ width:16px; height:16px; display:inline-block; fill:currentColor; color:var(--star); }
    .meta .divider{ width:1px; height:14px; background:var(--line); }

    .rule{ margin:16px 0; height:1px; background:var(--line); }

    /* âœ… å–®ä¸€è¦æ ¼ï¼šæ•¸é‡ */
    .qtyRow{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:10px;
    }
    .qtyLabel{
      font-size:14px;
      font-weight:900;
      letter-spacing:1px;
    }
    .qtyCtrl{
      display:flex;
      align-items:center;
      gap:8px;
      background: rgba(255,255,255,.65);
      border:1px solid rgba(0,0,0,.10);
      border-radius: 12px;
      padding: 8px 10px;
    }
    .qtyBtn{
      width:32px;
      height:32px;
      border:none;
      border-radius:10px;
      background: var(--btn);
      font-weight:900;
      cursor:pointer;
    }
    .qtyInput{
      width:56px;
      height:32px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,.12);
      text-align:center;
      font-weight:900;
      outline:none;
      background:white;
    }
    .stockHint{
      color:#777;
      font-size:12px;
    }

    /* CTA row */
    .ctaRow{ margin-top:16px; display:flex; gap:10px; align-items:center; }
    .addBtn{
      flex:1; height:40px; border:none; border-radius:10px;
      background:var(--btn); color:var(--btnText);
      font-weight:900; cursor:pointer;
    }
    .addBtn:hover{ filter:brightness(.97); }
    .pawBtn{
      width:40px; height:40px; border:none; border-radius:10px;
      background:var(--btn); cursor:pointer; font-size:18px;
      display:flex; align-items:center; justify-content:center;
    }

    /* sections below */
    .section{ margin-top:28px; }
    .section h2{ margin:0 0 10px; font-size:14px; letter-spacing:1px; font-weight:900; }
    .block{
      background:var(--panel);
      border-radius:12px;
      padding:22px;
      border:1px solid rgba(0,0,0,.05);
      color:rgba(0,0,0,.72);
      line-height:1.8;
    }

    /* reviews */
    .reviewHead{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; }
    .reviewScore{ display:flex; align-items:center; gap:8px; color:var(--muted); font-size:12px; }

    .reviewForm{
      background:var(--card);
      border:1px solid rgba(0,0,0,.08);
      border-radius:14px;
      padding:14px;
      display:grid;
      gap:10px;
    }
    .reviewForm.disabled{
      opacity:.6;
      pointer-events:none;
    }

    .starsPick{
      display:flex;
      gap:6px;
      align-items:center;
      user-select:none;
    }
    .pickStar{
      width:22px;
      height:22px;
      cursor:pointer;
      fill:currentColor;
      color:rgba(0,0,0,.18);
    }
    .pickStar.on{ color:var(--star); }

    textarea{
      width:100%;
      min-height:90px;
      resize:vertical;
      border-radius:10px;
      border:1px solid rgba(0,0,0,.12);
      padding:10px 12px;
      font-family:inherit;
      outline:none;
    }
    .submitRow{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
    }

    .hintText{
      color:#777;
      font-size:12px;
      line-height:1.5;
    }

    .reviewsList{
      margin-top:12px;
      display:grid;
      gap:10px;
    }
    .reviewItem{
      background:var(--card);
      border:1px solid rgba(0,0,0,.08);
      border-radius:14px;
      padding:12px 14px;
    }
    .reviewTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:6px;
    }
    .reviewUser{ font-weight:900; }
    .reviewTime{ font-size:12px; color:#888; }
    .reviewText{ color:#444; line-height:1.7; white-space:pre-wrap; }

    /* also bought */
    .alsoTitle{
      margin-top:36px;
      display:flex;
      align-items:center;
      gap:14px;
      justify-content:center;
      color:#111;
      font-weight:900;
      letter-spacing:2px;
    }
    .line{ flex:1; height:2px; background:rgba(0,0,0,.35); max-width:220px; }

    .cards{
      margin-top:18px;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:16px;
    }
    .p-card{
      display:block;
      text-decoration:none;
      color:inherit;
      background:var(--card);
      border:1px solid rgba(0,0,0,.08);
      border-radius:14px;
      overflow:hidden;
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .p-card:hover{
      transform: translateY(-2px);
      box-shadow: 0 10px 24px rgba(0,0,0,.08);
    }
    .p-img{
      aspect-ratio:4/3;
      background:var(--panel);
      background-size:cover;
      background-position:center;
    }
    .p-body{ padding:10px 10px 12px; }
    .p-name{
      font-weight:900;
      font-size:13px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      margin-bottom:6px;
    }
    .p-price{ font-weight:900; color:var(--accent); font-size:13px; }

    @media (max-width:860px){
      .top{ grid-template-columns:1fr; }
      .cards{ grid-template-columns:repeat(2,1fr); }
    }

    /* è©•è«–é€å‡ºæŒ‰éˆ•ï¼ˆMeow5 é¢¨æ ¼ï¼‰ */
    #submitReviewBtn{
      appearance: none;
      border: none;
      border-radius: 999px;
      padding: 10px 22px;
      background: linear-gradient(135deg, #d7bfb7, #cdb4aa);
      color: #1a1a1a;
      font-weight: 900;
      letter-spacing: 1px;
      cursor: pointer;
      transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
      box-shadow: 0 6px 14px rgba(0,0,0,.12);
    }
    #submitReviewBtn:hover{
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,0,0,.16);
      filter: brightness(1.02);
    }
    #submitReviewBtn:active{
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(0,0,0,.14);
    }
    #submitReviewBtn:disabled{
      opacity: .5;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }


    /* ===== Meow5 å°å¼•æ¬„ï¼ˆå¯ç›´æ¥å¥—ç”¨ï¼‰ ===== */
.site-header{
  position: sticky;
  top: 0;
  z-index: 999;
  background: rgba(246,241,238,.85);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(0,0,0,.08);
}

.nav{
  max-width: 1080px;
  margin: 0 auto;
  padding: 14px 18px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.brand{
  text-decoration: none;
  color: var(--ink);
  display:flex;
  align-items:center;
}
.brand-logo{
  font-weight: 1000;
  letter-spacing: 1px;
  font-size: 18px;
}

.nav-links{
  display:flex;
  align-items:center;
  gap: 14px;
}

.nav-links a{
  text-decoration:none;
  color: rgba(0,0,0,.72);
  font-weight: 800;
  padding: 8px 10px;
  border-radius: 999px;
  transition: background .15s ease, color .15s ease;
}
.nav-links a:hover{
  background: rgba(0,0,0,.06);
  color: rgba(0,0,0,.9);
}

.nav-toggle{
  display:none;
  border:none;
  background: var(--btn);
  color: var(--btnText);
  font-weight: 900;
  width: 40px;
  height: 40px;
  border-radius: 12px;
  cursor:pointer;
}

/* è®“åŸæœ¬å…§å®¹ä¸è¦è²¼åˆ°å°å¼•æ¬„ä¸‹é¢ */
.wrap{
  padding-top: 18px; /* ä½ åŸæœ¬ wrap padding æœ‰ 28px ä¹ŸOKï¼›é€™è¡Œåªæ˜¯æ›´ç©© */
}

@media (max-width: 860px){
  .nav-toggle{ display:flex; align-items:center; justify-content:center; }
  .nav-links{
    position: fixed;
    left: 0;
    right: 0;
    top: 62px;
    margin: 0 12px;
    background: rgba(255,255,255,.92);
    border: 1px solid rgba(0,0,0,.10);
    border-radius: 16px;
    padding: 12px;
    display: none;
    flex-direction: column;
    gap: 8px;
    box-shadow: 0 18px 40px rgba(0,0,0,.10);
  }
  .nav-links.open{ display:flex; }
  .nav-links a{ width:100%; text-align:center; }
}

  </style>
</head>

<body>

  <header class="site-header">
  <nav class="nav">
    <a class="brand" href="index.html" aria-label="å›åˆ°é¦–é ">
      <span class="brand-logo">Meow5</span>
    </a>

    <button class="nav-toggle" id="navToggle" aria-label="é–‹å•Ÿé¸å–®">â˜°</button>

    <div class="nav-links" id="navLinks">
      <a href="index.html">é¦–é </a>
      <a href="products.html">å•†å“</a>
      <a href="cart.html">è³¼ç‰©è»Š</a>
      <a href="member.html">æœƒå“¡</a>
    </div>
  </nav>
</header>


  <div class="wrap">
    <section class="top">

      <!-- left: gallery -->
      <div class="gallery">
        <div class="imgBox">
          <img id="mainImg" src="" alt="å•†å“åœ–ç‰‡" />
        </div>
        <div class="dots" id="dotsArea"></div>
      </div>

      <!-- right: info -->
      <div class="info">
        <h1 id="prodName">å•†å“å</h1>
        <div class="price" id="prodPrice">$XXX</div>

        <div class="meta" id="metaArea"></div>

        <div class="rule"></div>

        <!-- âœ… å–®ä¸€è¦æ ¼ï¼šåªä¿ç•™æ•¸é‡ï¼ˆå¯é¸ï¼‰ -->
        <div class="qtyRow">
          <div class="qtyLabel">æ•¸é‡</div>
          <div class="qtyCtrl">
            <button class="qtyBtn" id="qtyMinus" type="button">âˆ’</button>
            <input class="qtyInput" id="qtyInput" type="number" min="1" value="1" />
            <button class="qtyBtn" id="qtyPlus" type="button">ï¼‹</button>
          </div>
          <div class="stockHint" id="stockHint"></div>
        </div>

        <div class="ctaRow">
          <button class="addBtn" id="addToCartBtn">åŠ å…¥è³¼ç‰©è»Š</button>
          <button class="pawBtn" id="pawBtn" aria-label="æ”¶è—æˆ–åŠ å…¥æœ€æ„›">ğŸ¾</button>
        </div>
      </div>
    </section>

    <!-- ä¸‹æ–¹å€å¡Š -->
    <section class="section">
      <h2>å•†å“ä»‹ç´¹</h2>
      <div class="block" id="descBlock">æš«ç„¡ä»‹ç´¹</div>
    </section>

    <section class="section">
      <h2>è©³ç´°è¦æ ¼</h2>
      <div class="block" id="specBlock">æš«ç„¡è¦æ ¼</div>
    </section>

    <section class="section">
      <h2>ç©æ³•/ç”¨æ³•</h2>
      <div class="block" id="howBlock">æš«ç„¡èªªæ˜</div>
    </section>

    <!-- è©•è«– -->
    <section class="section" id="reviewSection">
      <div class="reviewHead">
        <h2 style="margin:0;">è©•è«–</h2>
        <div class="reviewScore" id="reviewScoreArea"></div>
      </div>

      <div class="reviewForm" id="reviewForm">
        <div class="starsPick" id="starsPick"></div>

        <textarea
          id="reviewText"
          placeholder="å¯«ä¸‹ä½ çš„ä½¿ç”¨å¿ƒå¾—..."
        ></textarea>

        <div class="submitRow">
          <span id="reviewHint" style="font-size:12px;color:#777;">
            å¿«ä¾†ç•™ä¸‹ä½ çš„æƒ³æ³•!!
          </span>
          <button id="submitReviewBtn">é€å‡ºè©•è«–</button>
        </div>
      </div>

      <div class="reviewsList" id="reviewsList"></div>
    </section>

    <!-- å…¶ä»–äººä¹Ÿè²·äº† -->
    <div class="alsoTitle">
      <div class="line"></div>
      <div>å…¶ä»–äººä¹Ÿè²·äº†</div>
      <div class="line"></div>
    </div>

    <section class="cards" id="alsoArea"></section>
  </div>

  <script src="./products-data.js"></script>
  <script>
    // =========================
    // å…¨ç«™çµ±ä¸€ key
    // =========================
    const CART_KEY = "meow5_cart";
    const REVIEWS_KEY = "MEOW5_REVIEWS";
    const FAV_KEY = "MEOW5_FAVORITES";

    // =========================
    // å– URL åƒæ•¸ ?id=...
    // =========================
    const params = new URLSearchParams(location.search);
    const id = params.get("id");
    const product = (window.PRODUCTS || []).find(p => p.id === id);

    if(!product){
      alert("æ‰¾ä¸åˆ°æ­¤å•†å“");
      location.href = "products.html";
    }

    // =========================
    // å°å·¥å…·
    // =========================
    function money(n){ return "$" + Number(n || 0).toLocaleString("zh-Hant"); }

    // âœ… ä¸è¦å†ç¡¬åŠ  image/ï¼Œé¿å…ä½ è³‡æ–™å·²ç¶“æ˜¯ image/xxx.png æ™‚è®Šæˆ image/image/xxx.png
    function resolveImg(src){
      if(!src) return "image/no-image.png";
      if(String(src).startsWith("http")) return src;
      if(String(src).startsWith("image/")) return src;
      return "image/" + src;
    }

    function generateStarsHTML(rating){
      const full = Math.round(Number(rating || 0));
      let html = "";
      for(let i=0;i<5;i++){
        const on = i < full;
        html += `
          <span class="star" aria-hidden="true" style="color:${on ? "var(--star)" : "rgba(0,0,0,.12)"}">
            <svg viewBox="0 0 24 24">
              <path d="M12 17.27 18.18 21 16.54 13.97 22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
            </svg>
          </span>
        `;
      }
      return html;
    }

    function readJSON(key, fallback){
      try{
        const raw = localStorage.getItem(key);
        if(!raw) return fallback;
        const data = JSON.parse(raw);
        return data ?? fallback;
      }catch{
        return fallback;
      }
    }

    function writeJSON(key, data){
      localStorage.setItem(key, JSON.stringify(data));
    }

    // =========================
    // 1) å•†å“åŸºæœ¬è³‡è¨Š
    // =========================
    document.getElementById("prodName").textContent = product.name;
    document.getElementById("prodPrice").textContent = money(product.price);

    const metaArea = document.getElementById("metaArea");
    metaArea.innerHTML = `
      <span>${product.boughtCount ?? 0} äººå·²è³¼è²·æ­¤ç”¢å“</span>
      <span class="divider"></span>
      <span class="rating">
        <span class="stars" aria-label="æ˜Ÿç­‰">${generateStarsHTML(product.rating)}</span>
        <span>ï¼ˆ${product.reviewCount ?? 0}ï¼‰</span>
      </span>
    `;

    document.getElementById("descBlock").textContent = product.description || "æš«ç„¡ä»‹ç´¹";
    document.getElementById("specBlock").textContent = product.specs || "æš«ç„¡è¦æ ¼";
    document.getElementById("howBlock").textContent = product.howToUse || "æš«ç„¡èªªæ˜";

    // âœ… åº«å­˜æç¤ºï¼ˆå¯æœ‰å¯ç„¡ï¼›products-data.js è‹¥æ²’çµ¦ stock æœƒé¡¯ç¤ºã€Œåº«å­˜å……è¶³ã€ï¼‰
    const stockHint = document.getElementById("stockHint");
    const stock = (typeof product.stock === "number") ? product.stock : null;
    stockHint.textContent = (stock === null) ? "åº«å­˜å……è¶³" : `åº«å­˜ï¼š${stock}`;

    // =========================
    // 2) åœ–ç‰‡è¼ªæ’­
    // =========================
    const mainImg = document.getElementById("mainImg");
    const dotsArea = document.getElementById("dotsArea");

    let currentIndex = 0;

    function showImage(idx){
      const imgName = (product.images || [])[idx];
      const src = imgName ? resolveImg(imgName) : "https://placehold.co/800x800?text=Meow5";
      mainImg.src = src;
      mainImg.alt = product.name + " åœ–ç‰‡ " + (idx+1);

      dotsArea.querySelectorAll(".dot").forEach((d,i) => {
        d.classList.toggle("active", i === idx);
      });
    }

    dotsArea.innerHTML = "";
    const imgs = Array.isArray(product.images) ? product.images : [];
    if(imgs.length === 0){
      mainImg.src = "https://placehold.co/800x800?text=Meow5";
      dotsArea.innerHTML = "";
    }else{
      imgs.forEach((_, i) => {
        const d = document.createElement("div");
        d.className = "dot" + (i===0 ? " active" : "");
        d.addEventListener("click", () => {
          currentIndex = i;
          showImage(i);
        });
        dotsArea.appendChild(d);
      });
      showImage(0);
    }

    // =========================
    // 3) æ•¸é‡æ§åˆ¶ï¼ˆå–®ä¸€è¦æ ¼ï¼‰
    // =========================
    const qtyInput = document.getElementById("qtyInput");
    const qtyMinus = document.getElementById("qtyMinus");
    const qtyPlus = document.getElementById("qtyPlus");

    function clampQty(v){
      let n = parseInt(v, 10);
      if(isNaN(n) || n < 1) n = 1;
      if(typeof product.stock === "number" && product.stock >= 0){
        n = Math.min(n, Math.max(0, product.stock));
        if(n < 1) n = 1; // è‹¥ä½ å…è¨±ç¼ºè²¨ä¸èƒ½è²·ï¼Œå¯åœ¨æ­¤æ”¹æˆ 0 ä¸¦ç¦ç”¨æŒ‰éˆ•
      }
      return n;
    }

    qtyMinus.addEventListener("click", () => {
      qtyInput.value = clampQty((parseInt(qtyInput.value,10)||1) - 1);
    });

    qtyPlus.addEventListener("click", () => {
      qtyInput.value = clampQty((parseInt(qtyInput.value,10)||1) + 1);
    });

    qtyInput.addEventListener("input", () => {
      qtyInput.value = clampQty(qtyInput.value);
    });

    // =========================
    // 4) åŠ å…¥è³¼ç‰©è»Šï¼ˆå–®ä¸€è¦æ ¼ï¼šåªå­˜ {id, qty}ï¼‰
    // =========================
    document.getElementById("addToCartBtn").addEventListener("click", () => {
      const qty = clampQty(qtyInput.value);

      // è‹¥ä½ è¦é™åˆ¶ç¼ºè²¨ä¸èƒ½åŠ ï¼Œå¯å•Ÿç”¨é€™æ®µï¼š
      // if(typeof product.stock === "number" && product.stock <= 0){
      //   alert("æ­¤å•†å“ç›®å‰ç¼ºè²¨");
      //   return;
      // }

      const cart = readJSON(CART_KEY, []);
      const exist = cart.find(i => i.id === product.id);

      if(exist){
        exist.qty = clampQty((parseInt(exist.qty,10)||1) + qty);
      }else{
        cart.push({ id: product.id, qty });
      }

      writeJSON(CART_KEY, cart);
      alert("å·²åŠ å…¥è³¼ç‰©è»Š ğŸ›’");
    });

    // =========================
    // 5) æ”¶è—ï¼ˆç¶­æŒä½ åŸæœ¬åŠŸèƒ½ï¼‰
    // =========================
    function readFavIds(){
      try{
        const v = JSON.parse(localStorage.getItem(FAV_KEY));
        return Array.isArray(v) ? v : [];
      }catch{
        return [];
      }
    }
    function writeFavIds(ids){
      localStorage.setItem(FAV_KEY, JSON.stringify(ids));
    }
    function isFav(pid){
      return readFavIds().includes(pid);
    }
    function updateFavBtn(){
      const pawBtn = document.getElementById("pawBtn");
      if(!pawBtn) return;
      pawBtn.textContent = isFav(product.id) ? "â¤ï¸" : "ğŸ¾";
      pawBtn.title = isFav(product.id) ? "å·²æ”¶è—" : "åŠ å…¥æ”¶è—";
    }

    document.getElementById("pawBtn").addEventListener("click", () => {
      const ids = readFavIds();
      const idx = ids.indexOf(product.id);

      if(idx >= 0){
        ids.splice(idx, 1);
        writeFavIds(ids);
        alert("å·²å¾æ”¶è—ç§»é™¤");
      }else{
        ids.push(product.id);
        writeFavIds(ids);
        alert("å·²åŠ å…¥æ”¶è—æ¸…å–®â¤ï¸");
      }
      updateFavBtn();
    });

    updateFavBtn();

    // =========================
    // 6) è©•è«–
    // =========================
    const reviewScoreArea = document.getElementById("reviewScoreArea");
    const reviewForm = document.getElementById("reviewForm");
    const reviewHint = document.getElementById("reviewHint");
    const reviewsList = document.getElementById("reviewsList");
    const starsPick = document.getElementById("starsPick");
    const reviewText = document.getElementById("reviewText");
    const submitReviewBtn = document.getElementById("submitReviewBtn");

    reviewScoreArea.innerHTML = `
      <span class="stars">${generateStarsHTML(product.rating)}</span>
      <span>${Number(product.rating || 0).toFixed(1)}</span>
    `;

    let picked = 5;
    function renderStarPicker(){
      starsPick.innerHTML = "";
      for(let i=1;i<=5;i++){
        const s = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        s.setAttribute("viewBox", "0 0 24 24");
        s.classList.add("pickStar");
        if(i <= picked) s.classList.add("on");
        s.innerHTML = `<path d="M12 17.27 18.18 21 16.54 13.97 22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>`;
        s.addEventListener("click", () => {
          picked = i;
          renderStarPicker();
        });
        starsPick.appendChild(s);
      }
    }
    renderStarPicker();

    function getReviews(){
      const all = readJSON(REVIEWS_KEY, []);
      return all.filter(r => r.productId === product.id)
                .sort((a,b) => (b.createdAt||0) - (a.createdAt||0));
    }

    function renderReviews(){
      const list = getReviews();
      reviewsList.innerHTML = "";

      if(list.length === 0){
        reviewsList.innerHTML = `<div class="hintText">ç›®å‰é‚„æ²’æœ‰è©•è«–ï¼Œä¾†ç•¶ç¬¬ä¸€å€‹åˆ†äº«çš„äººå§ ğŸ¾</div>`;
        return;
      }

      list.forEach(r => {
        const div = document.createElement("div");
        div.className = "reviewItem";
        div.innerHTML = `
          <div class="reviewTop">
            <div>
              <span class="reviewUser">${r.user || "æ‚¨"}</span>
              <span style="margin-left:10px" class="stars">${generateStarsHTML(r.stars || 0)}</span>
            </div>
            <div class="reviewTime">${new Date(r.createdAt || Date.now()).toLocaleString("zh-Hant")}</div>
          </div>
          <div class="reviewText">${(r.text || "").replace(/</g,"&lt;").replace(/>/g,"&gt;")}</div>
        `;
        reviewsList.appendChild(div);
      });
    }

    function updateReviewPermission(){
      reviewForm.classList.remove("disabled");
      reviewHint.textContent = "å¿«ä¾†ç•™ä¸‹ä½ çš„æƒ³æ³•!!";
      reviewText.placeholder = "é€™è£¡é‚„æ˜¯å…‰ç¦¿ç¦¿çš„è‰åœ°";
    }

    submitReviewBtn.addEventListener("click", () => {
      const text = (reviewText.value || "").trim();
      if(!text){
        alert("è©•è«–å…§å®¹ä¸èƒ½ç‚ºç©º");
        return;
      }

      const all = readJSON(REVIEWS_KEY, []);
      all.push({
        productId: product.id,
        user: "å°æ˜",
        stars: picked,
        text,
        createdAt: Date.now()
      });
      writeJSON(REVIEWS_KEY, all);

      reviewText.value = "";
      picked = 5;
      renderStarPicker();
      renderReviews();
      alert("è©•è«–å·²é€å‡º âœ…");
    });

    updateReviewPermission();
    renderReviews();

    // =========================
    // 7) å…¶ä»–äººä¹Ÿè²·äº†
    // =========================
    const alsoArea = document.getElementById("alsoArea");

    function pickAlsoProducts(){
      const all = (window.PRODUCTS || []).filter(p => p.id !== product.id);
      const sameTheme = all.filter(p => p.theme === product.theme);
      const pool = (sameTheme.length >= 4) ? sameTheme : all;

      const arr = pool.slice();
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr.slice(0,4);
    }

    function renderAlso(){
      const items = pickAlsoProducts();
      alsoArea.innerHTML = "";

      items.forEach(p => {
        const a = document.createElement("a");
        a.className = "p-card";
        a.href = `product-detail.html?id=${encodeURIComponent(p.id)}`;

        const imgName = (p.images || [])[0];
        const imgSrc = imgName ? resolveImg(imgName) : "https://placehold.co/900x700?text=Meow5";

        a.innerHTML = `
          <div class="p-img" style="background-image:url('${imgSrc}')"></div>
          <div class="p-body">
            <div class="p-name">${p.name}</div>
            <div class="p-price">${money(p.price)}</div>
          </div>
        `;
        alsoArea.appendChild(a);
      });
    }

    renderAlso();


    // ===== å°å¼•æ¬„ï¼šæ‰‹æ©Ÿæ¼¢å ¡é¸å–® =====
const navToggle = document.getElementById("navToggle");
const navLinks = document.getElementById("navLinks");

if(navToggle && navLinks){
  navToggle.addEventListener("click", () => {
    navLinks.classList.toggle("open");
  });

  // é»é€£çµå¾Œè‡ªå‹•æ”¶èµ·
  navLinks.addEventListener("click", (e) => {
    if(e.target.tagName === "A") navLinks.classList.remove("open");
  });

  // é»ç©ºç™½è™•æ”¶èµ·
  document.addEventListener("click", (e) => {
    if(!navLinks.contains(e.target) && !navToggle.contains(e.target)){
      navLinks.classList.remove("open");
    }
  });
}

  </script>
</body>
</html>
