<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è²“ç‰©è³ªæ„Ÿè³¼ç‰©è»Š - Meow5</title>
    <style>
      :root {
        --c-parchment: #edede9;
        --c-bone: #d6ccc2;
        --c-linen: #f5ebe0;
        --c-almond-cream: #e3d5ca;
        --c-almond-silk: #d5bdaf;
        --text-dark: #3d3d3d;
        --c-success: #84a59d;
        --accent: #b0714d;
      }

      body {
        font-family: "PingFang TC", "Noto Sans TC", sans-serif;
        background-color: var(--c-parchment);
        margin: 0;
        color: var(--text-dark);
      }

      /* æµ®å‹•è³¼ç‰©è»ŠæŒ‰éˆ• */
      .cart-trigger {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 70px;
        height: 70px;
        background: var(--c-almond-silk);
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        box-shadow: 0 10px 25px rgba(213, 189, 175, 0.5);
        z-index: 100;
        transition: transform 0.3s ease;
      }
      .cart-trigger:hover {
        transform: scale(1.1);
      }
      .cart-trigger span {
        font-size: 30px;
      }

      /* èƒŒæ™¯é®ç½© */
      .cart-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.3);
        display: none;
        z-index: 999;
        backdrop-filter: blur(3px);
      }

      /* è³¼ç‰©è»Šå´é‚Šæ¬„ */
      .cart-overlay {
        position: fixed;
        top: 0;
        right: -450px;
        width: 100%;
        max-width: 400px;
        height: 100%;
        background: #fff;
        box-shadow: -10px 0 30px rgba(0, 0, 0, 0.05);
        z-index: 1000;
        transition: right 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        display: flex;
        flex-direction: column;
      }
      .cart-overlay.active {
        right: 0;
      }

      .cart-header {
        padding: 30px;
        background: var(--c-linen);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .cart-header h3 {
        margin: 0;
        letter-spacing: 2px;
      }
      .close-cart {
        cursor: pointer;
        font-size: 24px;
        color: var(--c-almond-silk);
      }

      /* å…é‹é€²åº¦æ¢ */
      .shipping-promo {
        padding: 20px 30px;
        background: #fff;
        border-bottom: 1px solid var(--c-parchment);
      }
      .shipping-text {
        font-size: 0.85rem;
        margin-bottom: 10px;
      }
      .progress-bar {
        height: 8px;
        background: var(--c-parchment);
        border-radius: 4px;
        overflow: hidden;
      }
      .progress-fill {
        width: 0%;
        height: 100%;
        background: var(--c-almond-silk);
        transition: width 0.5s ease;
      }

      /* å•†å“åˆ—è¡¨ */
      .cart-items {
        flex-grow: 1;
        padding: 20px 30px;
        overflow-y: auto;
      }
      .item {
        display: flex;
        margin-bottom: 25px;
        align-items: center;
      }
      .item-img {
        width: 60px;
        height: 60px;
        border-radius: 10px;
        margin-right: 15px;
        background-size: cover;
        background-position: center;
        background-color: #f0f0f0;
      }
      .item-info {
        flex-grow: 1;
      }
      .item-name {
        font-weight: 600;
        font-size: 0.95rem;
        margin-bottom: 3px;
      }
      .item-price {
        color: var(--c-almond-silk);
        font-weight: bold;
        font-size: 0.9rem;
      }
      .item-qty-control {
        display: flex;
        align-items: center;
        margin-top: 8px;
        gap: 12px;
      }
      .qty-btn {
        width: 26px;
        height: 26px;
        border: 1px solid var(--c-bone);
        background: #fff;
        border-radius: 4px;
        cursor: pointer;
      }

      /* åº•éƒ¨çµç®—å€ */
      .cart-footer {
        padding: 30px;
        background: var(--c-parchment);
        border-radius: 30px 30px 0 0;
      }
      .summary-line {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 0.9rem;
        color: #666;
      }
      .total-row {
        display: flex;
        justify-content: space-between;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid var(--c-bone);
        font-size: 1.2rem;
        font-weight: bold;
        color: var(--accent);
      }

      .checkout-btn {
        width: 100%;
        padding: 18px;
        background: var(--c-almond-silk);
        color: white;
        border: none;
        border-radius: 15px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        margin-top: 20px;
        transition: all 0.3s;
      }
      .checkout-btn:hover {
        background: var(--text-dark);
        transform: translateY(-2px);
      }
      .checkout-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .empty-msg {
        text-align: center;
        color: #999;
        margin-top: 50px;
      }
    </style>
  </head>
  <body>
    <div style="padding: 50px; text-align: center">
      <h1>Meow5 è²“ç‰©å•†åº—</h1>
      <p>é»æ“Šå³ä¸‹è§’è‚‰çƒæŸ¥çœ‹è³¼ç‰©è»Š ğŸ¾</p>
      <a href="index.html" style="color: var(--accent); text-decoration: none">â† å›åˆ°é¦–é </a>
    </div>

    <div class="cart-trigger" id="openCart">
      <span>ğŸ¾</span>
    </div>

    <div class="cart-backdrop" id="backdrop"></div>

    <div class="cart-overlay" id="cart">
      <div class="cart-header">
        <h3>è³¼ç‰©è»Šæ¸…å–®</h3>
        <span class="close-cart" id="closeCart">âœ•</span>
      </div>

      <div class="shipping-promo">
        <div class="shipping-text" id="shippingText">è¼‰å…¥ä¸­...</div>
        <div class="progress-bar">
          <div class="progress-fill" id="shippingProgress"></div>
        </div>
      </div>

      <div class="cart-items" id="cartItemsList"></div>

      <div class="cart-footer">
        <div class="summary-line">
          <span>å°è¨ˆ Subtotal</span>
          <span id="subtotalPrice">$0</span>
        </div>
        <div class="summary-line">
          <span>é‹è²» Shipping</span>
          <span id="shippingFee">$0</span>
        </div>
        <div class="total-row">
          <span>ç¸½è¨ˆ Total</span>
          <span id="finalTotal">$0</span>
        </div>
        <button class="checkout-btn" id="payBtn" onclick="sendOrder()">å®Œæˆä»˜æ¬¾ï¼Œé€å‡ºè¨‚å–®</button>
      </div>
    </div>

    <script>
      // 1. åˆå§‹åŒ–è³‡æ–™
      let cartItems = JSON.parse(localStorage.getItem("meow5_cart")) || [];
      const FREE_SHIPPING_THRESHOLD = 1500;
      const DEFAULT_SHIPPING_FEE = 80;

      const cartOverlay = document.getElementById("cart");
      const openBtn = document.getElementById("openCart");
      const closeBtn = document.getElementById("closeCart");
      const backdrop = document.getElementById("backdrop");

      // 2. å´é‚Šæ¬„é–‹é—œ
      openBtn.addEventListener("click", () => {
        renderCartUI();
        cartOverlay.classList.add("active");
        backdrop.style.display = "block";
      });

      const closeCartFunc = () => {
        cartOverlay.classList.remove("active");
        backdrop.style.display = "none";
      };

      closeBtn.addEventListener("click", closeCartFunc);
      backdrop.addEventListener("click", closeCartFunc);

      // 3. æ¸²æŸ“ä»‹é¢ (åˆä½µè³¼ç‰©è»Šèˆ‡çµå¸³é‡‘é¡è¨ˆç®—)
      function renderCartUI() {
        const listContainer = document.getElementById("cartItemsList");
        const subtotalEl = document.getElementById("subtotalPrice");
        const shippingEl = document.getElementById("shippingFee");
        const finalTotalEl = document.getElementById("finalTotal");
        const progressFill = document.getElementById("shippingProgress");
        const shippingText = document.getElementById("shippingText");
        const payBtn = document.getElementById("payBtn");

        listContainer.innerHTML = "";
        let subtotal = 0;

        if (cartItems.length === 0) {
          listContainer.innerHTML = '<div class="empty-msg">æ‚¨çš„è³¼ç‰©è»Šæ˜¯ç©ºçš„å–µ... ğŸ¾</div>';
          payBtn.disabled = true;
        } else {
          payBtn.disabled = false;
          cartItems.forEach((item, index) => {
            subtotal += item.price * item.qty;

            // è™•ç†åœ–ç‰‡è·¯å¾‘ (ç›¸å®¹ checkout.html çš„é‚è¼¯)
            const imgSrc = item.image && item.image.startsWith("http") ? item.image : `images/${item.image}`;

            const itemDiv = document.createElement("div");
            itemDiv.className = "item";
            itemDiv.innerHTML = `
              <div class="item-img" style="background-image: url('${imgSrc}')"></div>
              <div class="item-info">
                <div class="item-name">${item.name}</div>
                <div class="item-price">$${item.price.toLocaleString()}</div>
                <div class="item-qty-control">
                  <button class="qty-btn" onclick="changeQty(${index}, -1)">-</button>
                  <span>${item.qty}</span>
                  <button class="qty-btn" onclick="changeQty(${index}, 1)">+</button>
                </div>
              </div>
            `;
            listContainer.appendChild(itemDiv);
          });
        }

        // é‹è²»èˆ‡ç¸½è¨ˆè¨ˆç®— (åˆä½µè‡ª checkout.html)
        const shippingFee = subtotal >= FREE_SHIPPING_THRESHOLD || subtotal === 0 ? 0 : DEFAULT_SHIPPING_FEE;
        const finalTotal = subtotal + shippingFee;

        // æ›´æ–°æ–‡å­—é¡¯ç¤º
        subtotalEl.textContent = `$${subtotal.toLocaleString()}`;
        shippingEl.textContent = shippingFee === 0 ? (subtotal >= FREE_SHIPPING_THRESHOLD ? "å…é‹âœ¨" : "$0") : `$${shippingFee}`;
        finalTotalEl.textContent = `$${finalTotal.toLocaleString()}`;

        // æ›´æ–°å…é‹é€²åº¦æ¢ (ä¾†è‡ª cart.html)
        const progress = Math.min((subtotal / FREE_SHIPPING_THRESHOLD) * 100, 100);
        progressFill.style.width = `${progress}%`;

        if (subtotal >= FREE_SHIPPING_THRESHOLD) {
          shippingText.innerHTML = "âœ¨ <b>æ­å–œï¼</b>å·²é”æˆå…é‹å„ªæƒ  ğŸšš";
          progressFill.style.backgroundColor = "var(--c-success)";
        } else {
          const diff = FREE_SHIPPING_THRESHOLD - subtotal;
          shippingText.innerHTML = `é‚„å·® <b>$${diff.toLocaleString()}</b> å³å¯äº«æœ‰å…é‹å„ªæƒ  ğŸšš`;
          progressFill.style.backgroundColor = "var(--c-almond-silk)";
        }
      }

      // 4. ä¿®æ”¹æ•¸é‡åŠŸèƒ½
      window.changeQty = function (index, delta) {
        cartItems[index].qty += delta;
        if (cartItems[index].qty <= 0) {
          if (confirm("ç¢ºå®šè¦ç§»é™¤é€™é …å•†å“å—ï¼Ÿ")) {
            cartItems.splice(index, 1);
          } else {
            cartItems[index].qty = 1;
          }
        }
        localStorage.setItem("meow5_cart", JSON.stringify(cartItems));
        renderCartUI();
      };

      // 5. é€å‡ºè¨‚å–®åŠŸèƒ½ (ä¾†è‡ª checkout.html)
      window.sendOrder = function () {
        if (confirm("ç¢ºå®šè¦é€å‡ºè¨‚å–®ä¸¦å®Œæˆä»˜æ¬¾å—ï¼Ÿ")) {
          alert("ğŸ‰ è¨‚å–®å·²é€å‡ºï¼\næˆ‘å€‘å°‡ç›¡å¿«ç‚ºæ‚¨çš„ä¸»å­å‡ºè²¨ ğŸˆ");
          localStorage.removeItem("meow5_cart");
          cartItems = [];
          renderCartUI();
          closeCartFunc();
          // window.location.href = "index.html"; // å¦‚æœéœ€è¦è·³è½‰å¯é–‹å•Ÿ
        }
      };

      // åˆå§‹åŸ·è¡Œä¸€æ¬¡
      renderCartUI();
    </script>
  </body>
</html>
